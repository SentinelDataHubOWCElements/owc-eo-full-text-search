<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../owc-ui-list/owc-ui-list.html">

<dom-module id="owc-eo-full-text-search">
  <template>
    <style is="custom-style">
      :host {
        display: block;
      }

      #searchboxinput {
        display: block;
        min-height: 40px;
        width: 98%;
        margin-bottom: 5px;
        align-self: center;
        font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 14px;
        resize: vertical;
        overflow-y: auto;
      }

      paper-icon-button {
        color: #002664;
        font-weight: bold;
      }

      paper-icon-button[toggles][active][raised].colorful {
        color: rgba(66, 133, 244, 0.75);
      }
    </style>
    <div id="search-container"></div>
    <paper-input label="Insert search criteria..." id="searchboxinput">
      <paper-icon-button style="width: 33px;" slot="suffix" on-click="clear" icon="clear" alt="clear" title="clear"></paper-icon-button>
      <paper-icon-button style="width: 33px;" slot="suffix" on-click="search" icon="search" alt="search" title="search"></paper-icon-button>
    </paper-input>
    </div>
  </template>

  <script>
    /**
     * `owc-eo-full-text-search`
     * Full Text Search component
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class OwcEoFullTextSearch extends Polymer.Element {
      static get is() { return 'owc-eo-full-text-search'; }
      static get properties() {
        return {
          prop1: {
            type: String,
            value: 'owc-eo-full-text-search'
          },

          res: {
            type: String,
            value: 'resDefaultValue'
          }
        };
      }

      search() {
        var self = this;
        if (this._ctx.am.logged == false) {
          this._ctx.wm.pushComponent(document.createElement('owc-ui-login-box'), "150px", "Login Title");
        } else {//User Logged
          var query = this.$.searchboxinput.value;
          var method = "GET";
          var subUrl = 'https://scihub.copernicus.eu/dhus/api/stub/products?filter=' + query + '&offset=0&limit=25&sortedby=ingestiondate&order=desc';
          var a = this._ctx.hm.sendRequest(method, subUrl).then(
            function (result) { //OK
              console.log('OK');
              console.log(result.data);
              var b = JSON.stringify(result.data);
              console.log(b);

              /*
               create list
              inject model (list.model = model)
              push list	
              */

              var list = document.createElement('owc-ui-list');
              list.model = result.data;
              self._ctx.wm.pushComponent(list, "150px", "List Title");

              return result;
            },
            function (err) { //ERROR
              console.log('ERROR');
              return err;
            });
          this._ctx.am.testListModel = a;
        }
      }

      pushListComponent(){
        console.log('pushListComponent');
        
      }

      clear() {
        this.$.searchboxinput.value = "";
      }
    }

    window.customElements.define(OwcEoFullTextSearch.is, OwcEoFullTextSearch);
  </script>
</dom-module>